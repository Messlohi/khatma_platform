<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Developer Dashboard v5 | Khatma Platform</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Unbounded:wght@400;600&family=Inter:wght@400;500;600&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="/static/css/developer.css">
</head>

<body>
    <div id="login-screen">
        <div class="login-box">
            <h2 style="font-family:'Unbounded'; color:var(--primary);">Dev Console</h2><input type="password"
                id="dev-key" placeholder="Access Key" onkeyup="if(event.key === 'Enter') login()"><button
                onclick="login()">Login</button>
            <p id="error-msg" style="color: var(--damage); margin-top: 10px;" class="hidden"></p>
        </div>
    </div>

    <div id="dashboard" class="hidden">
        <header class="header">
            <div class="brand">üöÄ Khatma Platform <span
                    style="font-size: 0.8rem; border: 1px solid var(--border); padding: 2px 6px; border-radius: 4px;">DEV
                    v5.0</span></div>
            <button class="btn-sm" onclick="logout()" style="width:auto;">Logout</button>
        </header>

        <div class="stats-grid">
            <div class="stat-card">
                <div style="color:var(--text-muted); font-size:0.85rem;">TOTAL KHATMAS</div>
                <div class="stat-value" id="stat-khatmas">-</div>
            </div>
            <div class="stat-card">
                <div style="color:var(--text-muted); font-size:0.85rem;">TOTAL USERS</div>
                <div class="stat-value" id="stat-users">-</div>
            </div>
            <div class="stat-card">
                <div style="color:var(--text-muted); font-size:0.85rem;">TOTAL READINGS</div>
                <div class="stat-value" id="stat-reads">-</div>
            </div>
        </div>

        <div class="content">
            <div class="filters">
                <div style="flex: 1; min-width: 200px;"><label>Search</label><input type="text" id="search-input"
                        placeholder="ID or Name..." onkeyup="if(event.key==='Enter') resetAndFetch()" style="margin:0;">
                </div>
                <div><label>Min Progress %</label><input type="number" id="filter-progress" placeholder="e.g. 50"
                        onkeyup="if(event.key==='Enter') resetAndFetch()"
                        style="margin:0; width: 100px; text-align: center;"></div>
                <div><label>Active Since</label><input type="date" id="filter-date" onchange="resetAndFetch()"
                        style="margin:0; width: auto; color-scheme: dark;"></div>
                <button class="btn-sm" onclick="resetAndFetch()" style="width: auto;">‚ö° Apply</button>
            </div>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th style="width: 40px;"><input type="checkbox" id="select-all" class="select-check"
                                    onclick="toggleSelectAll()"></th>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Users</th>
                            <th>Last Update</th>
                            <th>Progress</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="khatma-table"></tbody>
                </table>
            </div>

            <div id="loading-marker" style="text-align: center; padding: 20px; display: none;">‚è≥ Loading more...</div>
            <div id="end-marker" style="text-align: center; padding: 20px; font-size: 0.8rem; display: none;">No more
                results</div>
        </div>

        <div id="batch-bar" class="hidden">
            <span id="batch-count" style="font-weight: 600;">0 Selected</span>
            <button class="btn-sm btn-danger" onclick="batchDelete()">üóëÔ∏è Delete Selected</button>
            <button class="btn-sm" onclick="clearSelection()"
                style="background:transparent; border:1px solid #555;">Cancel</button>
        </div>
    </div>

    <!-- Details Modal -->
    <div id="details-modal" class="hidden"
        style="position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center; z-index: 100;">
        <div
            style="background: var(--surface); padding: 30px; border-radius: 12px; border: 1px solid var(--border); width: 95%; max-width: 1000px; max-height: 95vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                <h2 style="margin: 0;" id="detail-title">Details</h2>
                <button onclick="closeModal()"
                    style="background: none; border: none; font-size: 2rem; color: var(--text-muted); cursor: pointer; width: auto; padding: 0;">&times;</button>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 30px;">
                <!-- Left: Settings -->
                <div>
                    <h4
                        style="color: var(--primary); margin-top: 0; border-bottom: 1px solid var(--border); padding-bottom: 10px;">
                        ‚öôÔ∏è Settings</h4>
                    <label>Admin PIN (Master Key)</label>
                    <div style="display:flex; gap:10px;">
                        <input type="text" id="edit-admin-pin" style="text-align:center;">
                        <button class="btn-sm" onclick="saveAdminPin()">Update</button>
                    </div>
                    <label>Intention</label>
                    <textarea id="edit-intention" rows="3"></textarea>
                    <button class="btn-sm" onclick="saveSetting('intention')"
                        style="margin-bottom:15px;">Update</button>
                    <label>Deadline</label>
                    <div style="display:flex; gap:10px;">
                        <input type="date" id="edit-deadline" style="color-scheme:dark;">
                        <button class="btn-sm" onclick="saveSetting('deadline')">Set</button>
                    </div>

                    <h4
                        style="color: var(--primary); margin-top: 30px; border-bottom: 1px solid var(--border); padding-bottom: 10px;">
                        üõë Danger Zone</h4>
                    <button class="btn-sm" onclick="resetKhatma()"
                        style="background:var(--warning); color:black; margin-bottom:10px;">üîÑ Reset Progress</button>
                    <div style="font-size:0.75rem; color:var(--text-muted);">Clears all current assignments and
                        completions. Users remain.</div>
                </div>

                <!-- Right: Visualization & Users -->
                <div>
                    <h4
                        style="color: var(--primary); margin-top: 0; border-bottom: 1px solid var(--border); padding-bottom: 10px;">
                        üìä Hizb Status</h4>
                    <div id="hizb-grid" class="hizb-grid"></div>
                    <div
                        style="display: flex; gap: 15px; margin-top: 10px; font-size: 0.8rem; color: var(--text-muted);">
                        <span style="display:flex; align-items:center; gap:5px;">
                            <div style="width:10px; height:10px; background:#334155; border-radius:2px;"></div>
                            Available
                        </span>
                        <span style="display:flex; align-items:center; gap:5px;">
                            <div style="width:10px; height:10px; background:var(--warning); border-radius:2px;"></div>
                            Taken
                        </span>
                        <span style="display:flex; align-items:center; gap:5px;">
                            <div style="width:10px; height:10px; background:var(--success); border-radius:2px;"></div>
                            Completed
                        </span>
                    </div>

                    <h4
                        style="color: var(--primary); margin-top: 30px; border-bottom: 1px solid var(--border); padding-bottom: 10px;">
                        üë• User Management</h4>
                    <div
                        style="background: var(--bg); border: 1px solid var(--border); border-radius: 6px; height: 300px; overflow-y: auto; padding: 10px;">
                        <ul id="user-list" style="list-style: none; padding: 0; margin: 0;"></ul>
                    </div>
                </div>
            </div>

            <!-- Selection Banner (Hidden by default) -->
            <div id="selection-banner" class="selection-banner hidden">
                <div>
                    <span style="color:var(--text-muted); font-size:0.9rem;">Assigning to:</span>
                    <strong id="selection-target-name" style="color:white; margin-left:5px;">User</strong>
                    <span id="selection-count"
                        style="background:var(--primary); color:white; padding:2px 8px; border-radius:10px; font-size:0.75rem; margin-left:10px;">0
                        selected</span>
                </div>
                <div style="display:flex; gap:10px;">
                    <button onclick="cancelSelection()" class="btn-sm btn-danger">Cancel</button>
                    <button onclick="confirmSelection()" class="btn-sm"
                        style="background:var(--success); color:black;">Confirm Assignment</button>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/developer.js"></script>
</body>

</html>